Content-Type: multipart/mixed; boundary="===============7832870659841679070=="
MIME-Version: 1.0

--===============7832870659841679070==
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="uCernVM-master"

[amiconfig]
plugins=elastiq-setup condor

[condor]
use_ips=true
highport=42000
condor_user=condor
lowport=41000
condor_secret=12345
condor_group=condor
uid_domain=*

[elastiq-setup]
elastiq_check_queue_every_s=10
elastiq_idle_for_time_s=idle-time
elastiq_waiting_jobs_time_s=20
elastiq_n_jobs_per_vm=jobs-per-vm
elastiq_batch_plugin=htcondor
elastiq_estimated_vm_deploy_time_s=300
elastiq_check_vms_every_s=15
ec2_key_name=key-name

ec2_api_url=ec2-url
ec2_aws_secret_access_key=secret-key
ec2_aws_access_key_id=access-key
ec2_image_id=image-id
ec2_flavour=instance-flavor

ec2_user_data_b64=slave-userdata

cacerts_b64=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlFK3pDQ0ErT2dBd0lCQWdJUUNIQzh4YTgvMjVXYWtjdHE3dS9rWlRBTkJna3Foa2lHOXcwQkFRc0ZBREJsDQpNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ2hNTVJHbG5hVU5sY25RZ1NXNWpNUmt3RndZRFZRUUxFeEIzDQpkM2N1WkdsbmFXTmxjblF1WTI5dE1TUXdJZ1lEVlFRREV4dEVhV2RwUTJWeWRDQkJjM04xY21Wa0lFbEVJRkp2DQpiM1FnUTBFd0hoY05NVFF4TVRFNE1USXdNREF3V2hjTk1qUXhNVEU0TVRJd01EQXdXakJrTVFzd0NRWURWUVFHDQpFd0pPVERFV01CUUdBMVVFQ0JNTlRtOXZjbVF0U0c5c2JHRnVaREVTTUJBR0ExVUVCeE1KUVcxemRHVnlaR0Z0DQpNUTh3RFFZRFZRUUtFd1pVUlZKRlRrRXhHREFXQmdOVkJBTVREMVJGVWtWT1FTQlRVMHdnUTBFZ016Q0NBU0l3DQpEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTVYyRHcvWlF5azdiRzNSUjYzZUVMOGp3bmlvDQpTbmMxOFNOYjRFd2VRZWZDTVFDOWlEZEZkZDI1QWhDQUhvL3RaQ01FUmFlZ09UdUJUYzlqUDhKSi95S2VpTERTDQpscmxjaW5RZmtpb3E4aExJdDJoVXRWaEJnVUJvQmhwUGhTbjd0VTA4RDA4L1FKWWJ6cWpNWGpYL1pKajFkZDEwDQpWQVdnTmhFRUVpUlZZKytVZHk1MzhSVjI3dE9rV1VVaG42aSswU2Z0Q3Vpck9Nby9oOUhhOFkrNUN4OUU1K0N0DQo4NVhDRmszc2hLTTZrdFRQeG4zbXZjc2FRRSt6VkxIemoyOE5IdU8rU2FOVzVBZThqYWZPSGJCYlYxYlJ4Qno4DQptR1hSelVZdmtaUy9SWVZKK0cxU2h4d0NWZ0VuRnF0eUx2Ung1R0cxSUtENkptbHFDdkdybjIyM3p5VUNBd0VBDQpBYU9DQWFZd2dnR2lNQklHQTFVZEV3RUIvd1FJTUFZQkFmOENBUUF3RGdZRFZSMFBBUUgvQkFRREFnR0dNSGtHDQpDQ3NHQVFVRkJ3RUJCRzB3YXpBa0JnZ3JCZ0VGQlFjd0FZWVlhSFIwY0RvdkwyOWpjM0F1WkdsbmFXTmxjblF1DQpZMjl0TUVNR0NDc0dBUVVGQnpBQ2hqZG9kSFJ3T2k4dlkyRmpaWEowY3k1a2FXZHBZMlZ5ZEM1amIyMHZSR2xuDQphVU5sY25SQmMzTjFjbVZrU1VSU2IyOTBRMEV1WTNKME1JR0JCZ05WSFI4RWVqQjRNRHFnT0tBMmhqUm9kSFJ3DQpPaTh2WTNKc015NWthV2RwWTJWeWRDNWpiMjB2UkdsbmFVTmxjblJCYzNOMWNtVmtTVVJTYjI5MFEwRXVZM0pzDQpNRHFnT0tBMmhqUm9kSFJ3T2k4dlkzSnNOQzVrYVdkcFkyVnlkQzVqYjIwdlJHbG5hVU5sY25SQmMzTjFjbVZrDQpTVVJTYjI5MFEwRXVZM0pzTUQwR0ExVWRJQVEyTURRd01nWUVWUjBnQURBcU1DZ0dDQ3NHQVFVRkJ3SUJGaHhvDQpkSFJ3Y3pvdkwzZDNkeTVrYVdkcFkyVnlkQzVqYjIwdlExQlRNQjBHQTFVZERnUVdCQlJuL1lnZ0ZDZVl4d25TDQpKUm03NlZFUlkzVlFZakFmQmdOVkhTTUVHREFXZ0JSRjY2S3Y5SkxMZ2pFdFVZdW5weUdkODIzSUR6QU5CZ2txDQpoa2lHOXcwQkFRc0ZBQU9DQVFFQXFTZzFlc1I3MXRvbkhxeVl6eWMyVHhFeWRIVG1RTjBkemZKb2R6V3ZzNHhkDQp4Z1MvRmZRalo0dTViNWNFNjBhZHdzM0owYVN1Z1M3SnVySG9nTkFjeVRuQlZuWlpiSng5NDZudzA5RTAyRHhKDQpXWXNhbU02L3h2TFlNRFgvNlc5ZG9LODY3bVpUcnFxTWFjaSttcWVnZTlpQ1N6TVR5QWZ6ZDlmelpNMmVZL2xDDQpKMU91RURPSmNqY1Y4YjczSGpXaXpzTXQ4dGV5NWd2SGFjRGxIMTk4YVp0K3ppWWFNMFREdW5jRk83cGRQMEdKDQoraFk3N2dSdVc2eFdTKytNY1BKS2UxZTlHVzZMTmdkVUppMkdDWlFmWHplcjhDTS9qeXhmbHA1SGNhaEUzcW01DQpoUysxTkdDbFh3bWdta01kMUw4dFJOYU4ydjExeTE4V29BNWh3bkE5Tmc9PQ0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlEdHpDQ0FwK2dBd0lCQWdJUURPZmc1UmZZUnY2UDVXRDhHL0F3T1RBTkJna3Foa2lHOXcwQkFRVUZBREJsDQpNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ2hNTVJHbG5hVU5sY25RZ1NXNWpNUmt3RndZRFZRUUxFeEIzDQpkM2N1WkdsbmFXTmxjblF1WTI5dE1TUXdJZ1lEVlFRREV4dEVhV2RwUTJWeWRDQkJjM04xY21Wa0lFbEVJRkp2DQpiM1FnUTBFd0hoY05NRFl4TVRFd01EQXdNREF3V2hjTk16RXhNVEV3TURBd01EQXdXakJsTVFzd0NRWURWUVFHDQpFd0pWVXpFVk1CTUdBMVVFQ2hNTVJHbG5hVU5sY25RZ1NXNWpNUmt3RndZRFZRUUxFeEIzZDNjdVpHbG5hV05sDQpjblF1WTI5dE1TUXdJZ1lEVlFRREV4dEVhV2RwUTJWeWRDQkJjM04xY21Wa0lFbEVJRkp2YjNRZ1EwRXdnZ0VpDQpNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUN0RGhYTzVFT0FYTEdIODdkZytYRVNwYTdjDQpKcFNJcXZUTzlTQTVLRmhnRFBpQTJxa1ZsVEpoUExXeEtJU0tpdHlmQ2d5REYzcVBrS3lLNTNsVFhER0VLdllQDQptREkyZHN6ZTNUeW9vdTlxK3lIeVVtSGZueURYSCtLeDJmNFlaTklTVzEvNVdCZzF2RWZOb1RiNWEzL1VzRGcrDQp3UnZEakRQWjJDOFkvaWdQczZlRDFzTnVSTUJoTlpZVy9sbWNpM1p0MS9HaVN3MHIvd3R5MnA1ZzBJNlFOY1o0DQpWWWNnb2MvbGJRcklTWHd4bUROc0l1bUgwREphb3JvVGdoSHRPUmVkbVRweW9lYjZwTm5WRnpGMXJvVjlJcTQvDQpBVWFHOWloNXlMSGE1RmNYeEg0Y0RyQzBrcVpXczcyeWwrMnFwL0MzeGFnL2xSYlEvNkdXNndoZkdIZFBBZ01CDQpBQUdqWXpCaE1BNEdBMVVkRHdFQi93UUVBd0lCaGpBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXDQpCQlJGNjZLdjlKTExnakV0VVl1bnB5R2Q4MjNJRHpBZkJnTlZIU01FR0RBV2dCUkY2Nkt2OUpMTGdqRXRVWXVuDQpweUdkODIzSUR6QU5CZ2txaGtpRzl3MEJBUVVGQUFPQ0FRRUFvZzY4MytMdDhPTnljM3BrbEwvM2NtYllNdVJDDQpkV0t1aCt2eTFkbmVWck9mek00VUtMa05sMkJjRWt4WTVOTTlnMGxGV0pjMWFScW9SK3BXeG5tckV0aG5nWVRmDQpmd2s4bE9hNEppd2d2VDJ6S0luM1gvOGk0cGVFSCtsbDc0ZmczOEZuU2JOZDY3SUpLdXNtN1hpK2ZUOHI4N2NtDQpOVzFmaVFHMlNWdWZBUVdicXowbHdjeTJmOEx4YjRiRyttUm82NEV0bE90Q3QvcU1IdDFpOGI1UVo3ZHN2ZlB4DQpIMnNNTmdjV2Z6ZDhxVnR0ZXZFU1JtQ0QxeWNFdmt2T2w3N0RaeXBvRWQrQTV3d3pacjhURFJSdTgzOGZZeEFlDQorbzBiSlcxc2o2VzNZUUd4MHFNbW9SQnhuYTNpdy9uRG1WRzNLd2NJemk3bVVMS24rZ3BGTDZMdzhnPT0NCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0NCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQ0KTUlJRndqQ0NBNnFnQXdJQkFnSUpBTE1tQXNaOVNTWW5NQTBHQ1NxR1NJYjNEUUVCQ3dVQU1FTXhDekFKQmdOVg0KQkFZVEFrbFVNUTB3Q3dZRFZRUUtFd1JKVGtaT01TVXdJd1lEVlFRREV4eEpUa1pPSUVObGNuUnBabWxqWVhScA0KYjI0Z1FYVjBhRzl5YVhSNU1CNFhEVEUxTVRBd05qRXdNakl3TlZvWERUTXdNVEF3TmpFd01qSXdOVm93UXpFTA0KTUFrR0ExVUVCaE1DU1ZReERUQUxCZ05WQkFvVEJFbE9SazR4SlRBakJnTlZCQU1USEVsT1JrNGdRMlZ5ZEdsbQ0KYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt3Z2dJaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQ0R3QXdnZ0lLQW9JQw0KQVFEaVhkUjdrZks3ZHFjNXRRQ0RaM1lLRDg5Rml6R0ZobzJwQnh6ZGRVbWpWRWJFQmVPbUcvL3pLNEZtQmt1OA0KM1NUaWQzWW1ZT2NNTWY4QzBuQVZHa3RkancyaHFZVmpQK3B3N21ubVdGb2cvbU5Na3cvUTcvYXZMZW9pWThJKw0KcEp0V0tQQ2JoVFpJbks1OWsvS2NMczdicmF1VjQrZkJCcDJ2c2NPcE04ajRZNlRIN01BSkxzcllkZHpneENvRQ0KSXZqWjVjUlhjUEhETjduMldob2pONzBYdGxRZmhZTmpVbFNHSW9xZFZYT0VLVkJFRzc0T2xnODg4QUdlb0ZQeA0KU2M1RmFMbE0wR2VLTGdSWVl0RFV1OHRHTWRoTWRDVGdSVDUxNVAzNnY0MVA3SzR3WkdNZXhSYjRsN0JNSFZOZg0KbGpsVnFqcjhMMmYyZzREeTIxSFpERGxGZmNvcTZWemx0Y0RwRjNzOG81L3IzZVFpR1ZXVFNTMUpYSnBYTEpUYw0KZHZqNHE2aFBRRXNka3lIMmFxY3ZTMDZOMlhXV0cyN25wMEp6VnNpcEFQOVdSWXlMQUpPK0VUdHdPT3ZxdGFrRg0KN0pyUDBOYjZqeVNSUHkvUW1mWStqS213ZjZoSjNXSHEvOC82R3IxVlJUcTBzaStaQzQ2blk4OXBZZisrUUxLaw0KY2dlN3VLdmRkeGVwb0xWOTNIeC9HTUdjOTZqQXREL1I0WGNSZlJqTy8xKzlyd0JPWFpOTGVOVm9ENWVDaitBZA0KTkRGMU1ML1lhOEd2M0FPVkpOY3lBY00xNDVWYkZwaFp3a1NUaDNNOURSQktUcXlRSUJWVkFGNzVjcGtVMTNxYQ0KZFFCUVFPaGlGQVpDU1N4TEc2SXEwbFc1S3NmUXFIZDEzWGFTb3JQSVYvcDgwd0lEQVFBQm80RzRNSUcxTUE4Rw0KQTFVZEV3RUIvd1FGTUFNQkFmOHdEZ1lEVlIwUEFRSC9CQVFEQWdFR01CMEdBMVVkRGdRV0JCUkRqRTMrN0piSw0KNmU4S3BIM0JuUUxsbjcyV2dEQnpCZ05WSFNNRWJEQnFnQlJEakUzKzdKYks2ZThLcEgzQm5RTGxuNzJXZ0tGSA0KcEVVd1F6RUxNQWtHQTFVRUJoTUNTVlF4RFRBTEJnTlZCQW9UQkVsT1JrNHhKVEFqQmdOVkJBTVRIRWxPUms0Zw0KUTJWeWRHbG1hV05oZEdsdmJpQkJkWFJvYjNKcGRIbUNDUUN6SmdMR2ZVa21KekFOQmdrcWhraUc5dzBCQVFzRg0KQUFPQ0FnRUF6MG5lYzBzdEd5MzAraE5STjUyTmk1WVlDTUZGb1g0YUQ3TGRyV3QrTVQ4Nmk0VUZ6dlBSd3ZPcA0KYlBjUEM2M3NqUWJQK2plUGdGWHNtRWFQa0RLdWYweDM0NGxOeUFnSVUrSkZXaW5jNGd2NG5ONW9IZnVTWEc2Sg0KVVRmWUxIYVZ1UGFoS2VIVVVwQk95dHlPTURSS0crRmxHT3hRdmhub2hoalV3QmZmYnUxRkl1OTkzK2QwdzJHQw0KOVo0elQrR1VLU2x2aU9VWWJ6Y3REdUcwRDhGVldKSzdMNVNzakZTUFNmQ0psYldLR21kcEROVjJ2TnprYUhzQQ0KZFExM1dxeEU4YjBKVEhkcFMzdnNydmZTZWhZNElHNEZqMkhxc0RFL2RmbEgzZ2NKYjVsNGxzOGtjQTUzWVJHMg0KTkRUanZqZHEzdHY1QWxZSnpIS2N4cTF2aFVtVngxdmtnMWFZTmdjVjhtOHdrUGhzblF1VGRpUW04RUEzSXRPTw0KUk5ZYXdmdVZlUzAyMVJYd1JMMjkwSEZJbGZ3bTZpbVJtbEtlcEd2SkJXYnJWZHJyTENxNHM1VVBqY3huUW5aRQ0KdGFwUVBVdGZWMW05Vi9UNjloNWpyZlZ5MW5NTTRXV0E2TVZQbGpsb2wxazcyakFybStvWHZvRXZEaU5majJxag0KZ2Z2VjAzUjRHWHhQKzBFV0ZYYWM0dGlGRnU2WUM0SHU3b3UzOHRublcvbngreHVydm5zeElXN1pEYUxHS0NkKw0KVkptYitxaFUzTkp2RFBHakR1a3NYcDBpZGZoYks2UjJkRno3VUZTMURZZFJpdDdqZVpwb3U1RDRMYUlMMENRLw0KS2pVckM3TTZXK1poaWNjMGloYndiMDNwcEx2OS92YmowNk1ZNCtITWl2S2lLMW94ZCtRPQ0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ==

quota_min_vms=min-vms
quota_max_vms=max-vms

--===============7832870659841679070==
Content-Type: text/x-shellscript; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="test_script.sh"

#!/bin/bash
sed -i "s|Activity,Machine|Machine,MyType,Activity,TargetType|g" /usr/lib/python2.6/site-packages/elastiq/plugins/htcondor.py
sed -i "s|'condor_q', '-attributes', 'JobStatus', '-long'|'condor_q', '-all', '-global', '-attributes', 'JobStatus', '-long'|g" /usr/lib/python2.6/site-packages/elastiq/plugins/htcondor.py
service elastiq stop
service elastiq start
###############
# TEST SCRIPT #
###############
useradd cernvm
mkdir /home/cernvm/jobs/
mkdir /home/cernvm/jobs/log/
mkdir /home/cernvm/jobs/output/
mkdir /home/cernvm/jobs/error/
cat<< EOF > /home/cernvm/jobs/test.jdl
Universe = vanilla
Executable = /home/cernvm/jobs/test.sh
Log = /home/cernvm/jobs/log/test.log.\$(Cluster)\$(Process)
Output = /home/cernvm/jobs/output/test.out.\$(Cluster)\$(Process)
Error = /home/cernvm/jobs/error/test.err.\$(Cluster)\$(Process)
Queue 10
EOF
#
cat <<EOF> /home/cernvm/jobs/test.sh
#!/bin/bash
HOST=\$(hostname -I | awk '{print $1}')
DIR=\$(pwd)
sleep 5
echo "I'm sleeping in \$HOST"
echo ":-("
echo "More precisely in this directory \$DIR" 
echo ":-/"
sleep 20
echo "Now I'm running! So fun! :-)"
EOF
#
chown cernvm:root -R /home/cernvm/jobs/
chmod u+x -R /home/cernvm/jobs/
#
cat<<EOF>/root/README.txt
Root user can't submit condor jobs.
You can submit jobs using cernvm user [su - cernvm ] and you can test condor using the test.jdl file [ condor_submit jobs/test.jdl ].
Good fun! :)
EOF

--===============7832870659841679070==--
